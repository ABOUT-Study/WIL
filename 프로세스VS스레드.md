# 프로세스 VS 스레드
디스크에 있는 프로그램이 메모리에 로드되고 CPU 스케줄러에 따라 CPU가 프로세스를 실행합니다.  
이렇게 실행된 응용프로그램을 프로세스라고 할 수 있습니다.  
스레드는 프로세스 내 작업의 흐름이라고 합니다. 즉 실행된 프로세스의 연산의 주체라고 할 수 있습니다.  
* 하나의 프로그램이 여러개의 프로세스로 이루어져 있을 수도 있습니다.

스프링부트로 만든 어플리케이션을 예를 들면 스프링부트를 올리면 톰캣에서 port 할당해서 올라가는데 이게 하나의 프로세스가 됩니다.  
실행된 프로세스에 API 요청이 오면 기능들을 수행하게 되는데 이때 API 마다 스레드가 할당돼서 연산 작업을 수행합니다.  
* 톰캣의 스레드풀이 스레드를 관리해 주는데 미리 고정된 스레드 갯수를 가지고 API 하나당 스레드 하나를 할당해 줍니다.

## 프로세스와 스레드 메모리
프로세스는 CPU 코어와 메모리(RAMorHDD)에 직접 접근하는게 아니라 OS의 커널로부터 임시로 virtual_memory(제한된 공간)를 할당받아서 사용하는데 마찬가지로 스레드는 해당하는 프로세스의 virtual_memory 에 제한됩니다.  
프로세스에 할당되는 메모리는 아래의 구조와 같은데 프로세스 내의 스레드는 모두 스택을 제외하고 공유합니다.  
그리고 메모리에 프로세스가 올라가게 되면 운영체제는 PCB(Preocess Control Block) 프로세스 제어 블록도 함께 생성합니다.  
PCB 에는 프로세스에 대한 중요한 메타데이터들을 담고 있습니다.(프로세스의 상태 등)  

![image](https://github.com/ABOUT-Study/WIL/assets/68458092/45cb02f7-9443-4417-ab0d-fe4d49ace137)

#### 프로세스 메모리 구조
- Code: 실행 명령을 포함하는 코드들 (정적)
- Data: static 변수 or grobal 상수 (정적)
- Heap: 동적 변수 메모리 영역 (동적)
- Stack: 지역변수, 매개변수, 반환 값 등 일시적인 데이터 (동적)

## 컨텍스트 스위칭이란?
컨텍스트 스위칭이란 여러작업을 동시에 처리하는 것처럼 보이게 해주는 작업입니다.  
싱글코어 기준으로 여러개의 프로세스는 동시에 작업이 불가능합니다. 그래서 노래를 듣다가 코딩을 하게되면 노래가 꺼지게 됩니다.  
그래서 다수의 프로세스를 동시에 실행하기 위해 컨텍스트 스위칭이 일어납니다.  
프로세스에서의 컨텍스트 스위칭은 앞서 설명한 PCB를 교환하는 과정을 말합니다.  

![image](https://github.com/ABOUT-Study/WIL/assets/68458092/9ed8a3a8-f6e9-405b-9723-4ce82dc4335c)

A가 실행단계에서 준비단계로 넘어가고 B가 실행단계로 넘어가고 다시 준비단계로 넘어가면 A 가 다시 실행단계로 오면서 작업을 전환해가며 동시에 일어나는 것 처럼 보여지게하는데 스위칭이 일어날때마다 캐시미스등 많은 비용이 발생하게 됩니다.  
스레드에서도 컨텍스트 스위칭이 일어나는데 스레드는 스택을 제외한 나머지 자원을 공유하기 때문에  
프로세스의 스위칭보다 훨씬 비용이 적고 빠르다는 장점이 있습니다.

이 공유자원을 실생활로 예시를 들자면 저희가 사용하는 회의실을 프로세스라고 생각을 해보면  
회의실에는 모니터 의자 리모컨 등이 있습니다.  
프로세스의 컨텍스트 스위치일 경우엔 회의실을 사용하고 이자원들을 가지고 나가기 때문에  
다음사람들은 또 이 자원들을 가져와야 사용이 가능합니다.  
하지만 스레드의 컨텍스트 스위치는 이 자원들이 공유되기 때문에 가지고 있지 않아도  
다음사람은 사용할 수가 있어서 훨씬 비용이 적겠죠?

## 멀티프로세스 VS 멀티스레드 (하나의 어플리케이션을 기준)
### 멀티프로세스
- 각 프로세스는 독립적
- IPC 를 사용한 통신
- 자원 소모적, 개별 메모리 차지
- Context Switching 비용이 큼
- 동기화 작업이 필요하지 않음
### 멅티스레드
- Thread 끼리 긴밀하게 연결되어 있음
- 공유된 자원으로 통신 비용 절감
- 공유된 자원으로 메모리 효율 증감
- Context Switching 비용이 적음
- 공유 자원 관리를 해야함

![image](https://github.com/ABOUT-Study/WIL/assets/68458092/793f5101-6d0f-4f41-8161-1deba812f3ad)

멀티프로세스는 자원을 공유하지 않기 때문에 독립적입니다.  
그래서 하나의 응용프로그램에서 프로세스 하나가 문제가 생겨도 다른 프로세스에 영향을 주지 않습니다.  
하지만 공유자원이 없기 때문에 스위칭 비용이 비쌉니다.  
멀티스레드일 경우 스택을 제외한 나머지 자원을 공유하기 때문에 스위칭 비용이 프로세스에 비해 적습니다.  
하지만 자원을 공유하기 때문에 동시성&동기화 이슈가 발생하게 됩니다.  

### 그럼 멀티스레드가 좋은거 아닌가?
멀티스레드가 빠르니까 좋을 수 있지만 자원을 공유하기 때문에 하나의 스레드가 문제가 생기면  
해당 프로세스 자체에 영향을 줄 수 있기 때문에 정답은 없습니다.  

# 참고한 영상
- (널널한 개발자 TV) [Process와 Thread의 차이](https://www.youtube.com/watch?v=x-Lp-h_pf9Q)

- (우아한테크) [10분 테코톡] [🌷 코다의 Process vs Thread](https://www.youtube.com/watch?v=1grtWKqTn50&t=471s)
