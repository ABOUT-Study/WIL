# 도메인 모델 시작하기

## 도메인이란?
온라인 서점 소프트웨어를 개발한다고 할때 온라인으로 책을 판매하는 데 필요한 상품 조회, 구매, 결제, 배송 추적등의 기능을 제공해야한다.   
이때 온라인 서점은 소프트웨어로 해결하고자 하는 문제 영역, 즉 도메인에 해당한다.   
   
도메인 전문가란 해당 도메인을 잘 이해하는 사람 즉 고객사가 될 수 있고 제품을 만드는걸 요청한 사람이 된다.   
그 사람이 도메인 전문가이다.   
   
도메인 전문가와 개발자는 지식을 공유 해야한다. 도메인에 대해 정확하게 이해하지 않고 개발을 진행하면 원하지 않는 제품이 탄생하게 된다.   
   
아무리 뛰어난 개발자라도 도메인에 대한 이해 없이 코딩을 시작할 수 없다. 기획서, 유스케이스, 사용자 스토리와 같은 요구사항과 관련자와의 대화를 통해   
도메인을 이해하고 이를 바탕으로 도메인 모델 초안을 만들어야 비로소 코드를 작성할 수 있다.   
   
코드를 작성할때 작명을 처음부터 완벽하게 할 필요가 없다. 개발에 추가사항이 생기고 변경하면서 도메인의 객체 명칭은 변경하게될거고   
그렇게 변경하게 되다 보면 완성된 코드가 나올 것이다.   

## 문서화
문서화는 중요하다 개발자가 코드로 이해할수는 있지만 코드의 양은 방대하고 해석하는데 시간이 걸린다.   
그래서 문서화를 남겨 놓는다. 히스토리 추적에도 유용하게 잘 정리해서 남겨놔야 추후에 문서를 보고 이해할 수 있다.   

개인적인 생각: 지라를 사용하는곳은 지라 번호에 컨플이나 명세서의 링크를 남겨놓고 지라의 번호로 커밋은 남긴다면 히스토리 추적이 엄청나게 쉬워질 것이다.   

## 1장 정리
클린코드와 결이 비슷한 부분도 있다고 생각했다.
도메인을 코드로 작성할때는 의미없는 set을 넣지말자고 강조하고 코드의 작명규칙에 시간을 많이 쏟아서 작명을 잘하자고 한다.   
그리고 도메인에서 해결해야하는 기능은 도메인 자체에서 메소드를 만들자고도 강요 한다.   
그리고 벨류타입을 말하는 부분이 있는데 int price라는게 있다면 Money price로 객체를 포장하자고 말을 한다.   

이책에서의 논의하고자 하는 내용

문서화
- 문서화가 잘되어 있다? 지라, 컨플러운스를 통해 따라가기 쉽게 정리 (분류가 잘되어 있다)
- UML? => 경험상 코드보다 이해가 더 잘되었다.
- 히스토리를 찾기 위해 문서를 찾는 과정이 어려웠다.

밸류 타입
- 변경 여부에 따라 설정하자
- 매개변수 개수가 3개 정도 이상이 되었을 때 의미적으로 묶을 수 있는지 생각해보자


# 아키텍처 개요

## 네 개의 영역
표현, 응용, 도메인, 인프라스트럭처는 아키텍처를 설계할 때 출현하는 전형적인 네가지 영역이다.   

<img width="417" alt="image" src="https://user-images.githubusercontent.com/20812458/216753756-015484b1-9d2e-4a9f-b032-45b781dc756a.png">   

위와 같이 표현영역은 사용자의 요청을 받아 응용에 전달을 하고 리턴되는 값을 받아 다시 사용자에게 전달을 해주는 역할을 한다.   
영역은 기능을구현하기 위해 도메인 영역의 도메인 모델을 사용한다. 주문 취소 기능을 제공하는 응용 서비스를 예로 살펴보면 다음과 같이 주문 도메인 모델을 사용해서 기능을 구현 한다.   

<img width="370" alt="image" src="https://user-images.githubusercontent.com/20812458/216753848-ca71d159-72c2-42a5-a239-a68d5bdcf430.png">   

응용 서비스는 로직을 직접 수행하기 보다는 도메인 모델에 로직 수행을 위임한다. 위 코드도 주문 취소 로직을 직접 구현하지 않고 Order 객체에 취소 처리를 위임하고 있다.   

<img width="343" alt="image" src="https://user-images.githubusercontent.com/20812458/216753902-ec2ad86a-bc7e-4026-971e-0c41a0a8b798.png">

응용 영역은 도메인 모델을 이용해서 사용자에게 제공할 기능을 구현한다. 실제 도메인 로직 구현은 도메인 모델에 위임한다.   
   
인프라스트럭처 영역은 논리적인 개념을 표현하기 보다는 실제 구현을 다룬다.

<img width="367" alt="image" src="https://user-images.githubusercontent.com/20812458/216755442-a203e802-1b85-432f-a76a-89dc9ab28145.png">   

개발을 하다보면 도메인은 인프라스트럭처에 의존을 하게 된다 하지만 이 방식은 좋지 않아 아래와 같은 방법으로 인터페이스를 중간에 두어 고수준과 저수준을 나누어서 관리를 하게 된다.   
<img width="429" alt="image" src="https://user-images.githubusercontent.com/20812458/216755905-120c2511-e83c-4ff7-a2b6-36e3f7f42855.png">   
<img width="418" alt="image" src="https://user-images.githubusercontent.com/20812458/216755910-f31a609f-0a44-46ba-a26c-2f7bee941892.png">   
<img width="373" alt="image" src="https://user-images.githubusercontent.com/20812458/216755915-2fee808c-1619-46d8-942f-6e5fe50ee8ff.png">   

이러한 것을 DIP라고 한다 저수준 모듈이 고수준 모듈에 읜존하도록 변경하는 것이다.   
   
<img width="301" alt="image" src="https://user-images.githubusercontent.com/20812458/216756028-e49ae016-3b82-42d2-bb39-464327adef58.png">   
   
DIP는 항상 적용할 필요는 없다. 사용하는 구현 기술에 따라 완벽한 DIP를 적용하기보다는 구현 기술에 의존적인 코드를 도메인에 일부 포함하는게 효과적일 때도 있다.   

아래는 잘못된 예를 보여준다. 인터페이스와 구현 클래스를 분리하는게 DIP는 아니다.   

<img width="426" alt="image" src="https://user-images.githubusercontent.com/20812458/216756224-c69ba87f-fbf7-4aa5-8661-8b3554dbf39b.png">   
   
RuleEngine인터페이스는 고수준 모듈인 도메인 관점이 아니라 룰 엔진이라는 저수준 모듈 관점에서 도출되어있다. 이것은 DIP가 아니다.   

예를들어 할인금액계산을 토대로 만들어진다면 밑에와 같은 그림이 되어야 한다.   

<img width="377" alt="image" src="https://user-images.githubusercontent.com/20812458/216756286-0418e32a-0e4a-48ac-84ef-323d8877f505.png">   
