# 다양한 연관관계 매핑

## 1. 일대다(OneToMany) 단방향
- **권장하지 않는 방법, 실무에서도 거의 사용되지 않음**
- 다대일 관계는 자신이 매핑한 테이블의 외래키를 관리하는데, 일대다는 반대쪽 테이블에 있는 외래키를 관리한다(외래키는 항상 다쪽 테이블에 존재하기때문)    
![jpa-6-1](https://user-images.githubusercontent.com/22884224/190866787-52d8a221-73f8-42f3-84d4-0a44d8122505.png)
- 권장하지 않는 이유
  1. 테이블에서는 항상 다(N)쪽에 외래키가 있기 때문에 패러다임과 맞지않음. 헷갈림
  2. 실무에선 테이블이 여러개 사용되는데, 일대다는 관리가 어렵다.
  3. 일대다에서 엔티티가 저장될때 양쪽 객체를 저장한 뒤 외래키를 설정하는 update 쿼리가 한번 더 사용된다.

결론 : 기본은 다대일로 구현하다가 필요할 때만 일대다 연관관계를 사용하자.

## 2. 일대다 양방향
- 이런 매핑은 공식적으로 존재하지 않는다.
- 하지만 일대다 연관관계에서 다쪽에 다대일 단방향 매핑(읽기전용)을 추가해서 양방향처럼 보이도록 할 수는 있다.
- 다쪽의 @JoinColumn에는 속성으로 insertable=false, updatable=false를 추가해야지만 읽기 전용이 가능하다.   
![image](https://user-images.githubusercontent.com/22884224/190866805-07456a87-6ac7-4ec2-a25a-1662268d205a.png)
- **일대다 양방향을 쓸거면 그냥 다대일 양방향을 사용하자**

## 3. 일대일
- 일대일 관계는 양쪽이 서로 하나의 관계만 가진다. 
  - ex) 회원은 하나의 사물함만을 사용하고, 사물함도 하나의 회원에 의해서만 사용된다.
- 주 테이블이나 대상 테이블 중 어느 곳이나 외래키를 가질 수 있다.
- 정리
  1. 주 테이블에 외래키
     - 주 객체가 대상 객체의 참조를 가지는 것처럼 주 테이블에 외래키를 두고 대상 테이블을 찾음.
     - 객체 지향 개발자가 선호하는 방법
     - 장점 : 주 테이블만 조회해도 대상 테이블에 데이터가 있는지 확인 가능
     - 단점 : 값이 없으면 외래키에 null 허용
  2. 대상 테이블의 외래키
     - 대상 테이블에 외래 키가 존재
     - DB 개발자가 선호하는 방법
     - 장점 : 주 테이블과 대상 테이블을 일대일에서 일대다 관계로 변경할때 테이블 구조가 유지된다.
     - 단점 : 주 테이블에는 외래키가 없기 때문에 대상 테이블이 있는지 없는지 알 수 없기때문에 즉시로딩이 무조건 된다.

## 4. 다대다
- 실무에서 거의 사용하지도 않고 추천하지도 않는 연관관계
- 컬렉션을 사용해서 객체 2개로 다대다 관계 가능
- @JoinTable로 연결테이블을 지정한다.
- 한계
  - 연결 테이블(중간테이블)에 추가적인 데이터를 넣을 수 없다는 한계점이 존재한다(추가 데이터를 매핑할 수 없기 때문에)
- 다대다 한계 극복
  - 연결 테이블용 엔티티 추가(= 연결 테이블을 엔티티로 승격)    
    - ex) Member와 Product 사이의 MemberProduct 연결 테이블을 엔티티로 추가
  - 결국 @ManyToMany가 아닌 @OneToMany, @ManyToOne 를 사용해야한다.   
![jpa-6-3](https://user-images.githubusercontent.com/22884224/190867178-cb2f573d-e59c-479e-87e4-7aa172af2260.png)


    
    
